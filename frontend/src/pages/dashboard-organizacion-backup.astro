---
import Layout from '../layouts/Layout.astro';
---

<Layout>
  <div class="min-h-screen bg-gradient-to-br from-purple-600 via-pink-500 to-red-500">
    <!-- Navigation -->
    <nav class="bg-white/95 backdrop-blur-xl border-b border-white/20 shadow-lg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center">
            <h1 class="text-xl font-bold text-purple-600">Portal de Organizaciones</h1>
          </div>
          <div class="flex items-center space-x-4">
            <a href="#" class="text-gray-700 hover:text-purple-600 px-3 py-2 rounded      // Total de voluntarios registrados (suma de todos los voluntarios_inscritos)
      const totalVoluntarios = events.reduce((sum, event) => {
        // Priorizar voluntarios_inscritos, luego participantesRegistrados
        if (event.voluntarios_inscritos && Array.isArray(event.voluntarios_inscritos)) {
          return sum + event.voluntarios_inscritos.length;
        } else if (event.participantesRegistrados) {
          return sum + event.participantesRegistrados;
        }
        return sum;
      }, 0);

      // Estimaci√≥n de horas de voluntariado (basado en duraci√≥n del evento)
      const horasVoluntariado = events.reduce((sum, event) => {
        let voluntariosEvento = 0;
        
        // Obtener n√∫mero de voluntarios
        if (event.voluntarios_inscritos && Array.isArray(event.voluntarios_inscritos)) {
          voluntariosEvento = event.voluntarios_inscritos.length;
        } else if (event.participantesRegistrados) {
          voluntariosEvento = event.participantesRegistrados;
        }
        
        if (voluntariosEvento > 0) {
          try {
            // Intentar m√∫ltiples formatos de fecha
            let start, end;
            
            // Formato 1: fechaInicio (ISO string)
            if (event.fechaInicio) {
              start = new Date(event.fechaInicio);
            } else if (event.fecha_inicio) {
              start = new Date(event.fecha_inicio);
            }
            
            if (event.fechaFin) {
              end = new Date(event.fechaFin);
            } else if (event.fecha_fin) {
              end = new Date(event.fecha_fin);
            }
            
            // Validar que las fechas sean v√°lidas
            if (start && end && !isNaN(start.getTime()) && !isNaN(end.getTime())) {
              const duracionMs = end.getTime() - start.getTime();
              const duracionHoras = Math.max(1, Math.round(duracionMs / (1000 * 60 * 60))); // M√≠nimo 1 hora
              return sum + (voluntariosEvento * duracionHoras);
            } else {
              // Si no podemos calcular la duraci√≥n, usar 4 horas por defecto
              console.warn('No se pudo calcular duraci√≥n para evento:', event.id || event.titulo);
              return sum + (voluntariosEvento * 4);
            }
          } catch (error) {
            console.error('Error calculando horas para evento:', event.id || event.titulo, error);
            // Usar 4 horas por defecto en caso de error
            return sum + (voluntariosEvento * 4);
          }
        }
        return sum;
      }, 0);dium">
              Eventos
            </a>
            <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
              Cerrar Sesi√≥n
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-white mb-4">
          Bienvenido a tu Dashboard
        </h1>
        <p class="text-white/80 text-lg">
          Gestiona tus eventos de voluntariado y conecta con voluntarios
        </p>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white/95 backdrop-blur-xl rounded-xl p-6 border border-white/20 text-center">
          <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Eventos Activos</h3>
          <div class="text-3xl font-bold text-purple-600 mt-2" id="eventos-activos">-</div>
          <p class="text-gray-500 text-sm mt-1">En curso</p>
        </div>

        <div class="bg-white/95 backdrop-blur-xl rounded-xl p-6 border border-white/20 text-center">
          <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Voluntarios Registrados</h3>
          <div class="text-3xl font-bold text-purple-600 mt-2" id="voluntarios-registrados">-</div>
          <p class="text-gray-500 text-sm mt-1">Este mes</p>
        </div>

        <div class="bg-white/95 backdrop-blur-xl rounded-xl p-6 border border-white/20 text-center">
          <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Horas de Voluntariado</h3>
          <div class="text-3xl font-bold text-purple-600 mt-2" id="horas-voluntariado">-</div>
          <p class="text-gray-500 text-sm mt-1">Total acumuladas</p>
        </div>

        <div class="bg-white/95 backdrop-blur-xl rounded-xl p-6 border border-white/20 text-center">
          <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Eventos Completados</h3>
          <div class="text-3xl font-bold text-purple-600 mt-2" id="eventos-completados">-</div>
          <p class="text-gray-500 text-sm mt-1">Exitosos</p>
        </div>
      </div>

      <!-- Content Grid -->
      <div class="grid grid-cols-1 gap-8">
        <!-- Eventos -->
        <div class="bg-white/95 backdrop-blur-xl rounded-xl p-6 border border-white/20">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-gray-800">Eventos</h2>
            <button 
              id="nuevo-evento-btn"
              class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Nuevo Evento
            </button>
          </div>
          
          <div id="eventos-container">
            <!-- Estado de carga inicial -->
            <div id="loading-state" class="text-center py-12">
              <div class="animate-pulse">
                <div class="w-12 h-12 bg-purple-200 rounded-full mx-auto mb-4 animate-bounce"></div>
                <div class="h-4 bg-purple-200 rounded w-48 mx-auto mb-2"></div>
                <div class="h-3 bg-purple-200 rounded w-32 mx-auto"></div>
              </div>
              <p class="text-purple-600 mt-4 font-medium">Cargando eventos...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para crear evento -->
    <div id="event-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center p-6 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-800">Crear Nuevo Evento</h2>
          <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        
        <form id="event-form" class="p-6 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">T√≠tulo del Evento</label>
              <input type="text" name="titulo" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Categor√≠a</label>
              <select name="categoria_id" required 
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                <option value="">Seleccionar categor√≠a</option>
                <option value="1">Educaci√≥n</option>
                <option value="2">Salud</option>
                <option value="3">Medio Ambiente</option>
                <option value="4">Ayuda Social</option>
                <option value="5">Cultura y Arte</option>
                <option value="6">Deportes</option>
                <option value="7">Tecnolog√≠a</option>
                <option value="8">Emergencias</option>
              </select>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
            <textarea name="descripcion" rows="3" required
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de Inicio</label>
              <input type="date" name="fecha_inicio" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Hora de Inicio</label>
              <input type="time" name="hora_inicio" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de Fin</label>
              <input type="date" name="fecha_fin" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Hora de Fin</label>
              <input type="time" name="hora_fin" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Direcci√≥n</label>
              <input type="text" name="direccion" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Capacidad M√°xima</label>
              <input type="number" name="capacidad_maxima" min="1" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Requisitos (opcional)</label>
            <textarea name="requisitos" rows="2" placeholder="Separar cada requisito con una coma"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
          </div>
          
          <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
            <button type="button" onclick="closeEventModal()" 
                    class="px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
              Cancelar
            </button>
            <button type="submit" 
                    class="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">
              Crear Evento
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Logout -->
  <div id="logout-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Cerrar Sesi√≥n</h3>
      </div>
      <div class="modal-body">
        <p>¬øEst√°s seguro de que quieres cerrar sesi√≥n?</p>
      </div>
      <div class="modal-footer">
        <button id="cancel-logout" class="btn-cancel">Cancelar</button>
        <button id="confirm-logout" class="btn-confirm">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Eliminaci√≥n de Evento -->
  <div id="delete-event-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="text-red-600">
          <svg class="w-6 h-6 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          Eliminar Evento
        </h3>
      </div>
      <div class="modal-body">
        <p class="text-gray-700 mb-3">¬øEst√°s seguro de que quieres eliminar este evento?</p>
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
          <div class="flex items-start">
            <svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <div>
              <p class="text-yellow-800 text-sm font-medium">Advertencia:</p>
              <p class="text-yellow-700 text-sm">Esta acci√≥n no se puede deshacer. Se eliminar√° toda la informaci√≥n del evento, incluyendo los voluntarios registrados y los datos asociados.</p>
            </div>
          </div>
        </div>
        <div id="event-to-delete-info" class="bg-gray-50 rounded-lg p-3">
          <p class="text-sm text-gray-600 mb-1">Evento a eliminar:</p>
          <p id="event-title-to-delete" class="font-semibold text-gray-800"></p>
          <p id="event-date-to-delete" class="text-sm text-gray-600"></p>
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancel-delete-event" class="btn-cancel">Cancelar</button>
        <button id="confirm-delete-event" class="btn-confirm bg-red-600 hover:bg-red-700 flex items-center">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
          </svg>
          Eliminar Evento
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Edici√≥n de Evento -->
  <div id="edit-event-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center p-6 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-800">Editar Evento</h2>
        <button id="close-edit-modal-btn" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <form id="edit-event-form" class="p-6 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">T√≠tulo del Evento</label>
            <input type="text" id="edit-titulo" name="titulo" required 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Categor√≠a</label>
            <select id="edit-categoria" name="categoria_id" disabled 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-500 cursor-not-allowed">
              <option value="">Seleccionar categor√≠a</option>
              <option value="1">Educaci√≥n</option>
              <option value="2">Salud</option>
              <option value="3">Medio Ambiente</option>
              <option value="4">Ayuda Social</option>
              <option value="5">Cultura y Arte</option>
              <option value="6">Deportes</option>
              <option value="7">Tecnolog√≠a</option>
              <option value="8">Emergencias</option>
            </select>
            <p class="text-xs text-gray-500 mt-1">La categor√≠a no se puede modificar</p>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
          <textarea id="edit-descripcion" name="descripcion" rows="3" required
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de Inicio</label>
            <input type="date" id="edit-fecha-inicio" name="fecha_inicio" required 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Hora de Inicio</label>
            <input type="time" id="edit-hora-inicio" name="hora_inicio" required 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de Fin</label>
            <input type="date" id="edit-fecha-fin" name="fecha_fin" required 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Hora de Fin</label>
            <input type="time" id="edit-hora-fin" name="hora_fin" required 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Direcci√≥n</label>
            <input type="text" id="edit-direccion" name="direccion" disabled 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-500 cursor-not-allowed">
            <p class="text-xs text-gray-500 mt-1">La direcci√≥n no se puede modificar</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Capacidad M√°xima</label>
            <input type="number" id="edit-capacidad-maxima" name="capacidad_maxima" min="1" required 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Requisitos (opcional)</label>
          <textarea id="edit-requisitos" name="requisitos" rows="2" placeholder="Separar cada requisito con una coma"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
        </div>
        
        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
          <button type="button" onclick="closeEditEventModal()" 
                  class="px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
            Cancelar
          </button>
          <button type="submit" 
                  class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
            Editar Evento
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module">
    const API_BASE_URL = 'http://localhost:3001/api';
    
    const OrganizacionService = {
      getAuthHeaders() {
        const token = localStorage.getItem('organizacionAuthToken');
        console.log('üîë Token obtenido de localStorage:', token ? 'PRESENTE' : 'AUSENTE');
        return {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        };
      },

      async getProfile() {
        try {
          console.log('üë§ OrganizacionService.getProfile() iniciado...');
          
          const headers = this.getAuthHeaders();
          console.log('üë§ Headers preparados:', headers);
          
          const url = `${API_BASE_URL}/organizacionAuth/profile`;
          console.log('üë§ URL a llamar:', url);
          
          const response = await fetch(url, {
            method: 'GET',
            headers: headers,
          });

          console.log('üë§ Respuesta recibida:', response.status, response.statusText);
          
          const data = await response.json();
          
          console.log('üì¶ Datos del perfil:', data);
          
          if (!response.ok) {
            throw new Error(data.message || 'Error obteniendo perfil');
          }

          return data;
        } catch (error) {
          console.error('‚ùå Error en OrganizacionService.getProfile():', error);
          return {
            success: false,
            message: error instanceof Error ? error.message : 'Error de conexi√≥n con el servidor'
          };
        }
      }
    };

    const EventoService = {
      getAuthHeaders() {
        const token = localStorage.getItem('organizacionAuthToken');
        console.log('üîë Token obtenido de localStorage:', token ? 'PRESENTE' : 'AUSENTE');
        return {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        };
      },

      async getEventos() {
        try {
          console.log('üìã EventoService.getEventos() iniciado...');
          
          const headers = this.getAuthHeaders();
          console.log('üìã Headers preparados:', headers);
          
          const url = `${API_BASE_URL}/eventos`;
          console.log('üìã URL a llamar:', url);
          
          const response = await fetch(url, {
            method: 'GET',
            headers: headers,
          });

          console.log('üìã Respuesta recibida:', response.status, response.statusText);
          
          const data = await response.json();
          
          console.log('üì¶ Datos parseados:', data);
          
          if (!response.ok) {
            throw new Error(data.message || 'Error obteniendo eventos');
          }

          return data;
        } catch (error) {
          console.error('‚ùå Error en EventoService.getEventos():', error);
          return {
            success: false,
            message: error instanceof Error ? error.message : 'Error de conexi√≥n con el servidor'
          };
        }
      },

      async createEvento(eventoData) {
        try {
          console.log('üéØ EventoService.createEvento() iniciado con datos:', eventoData);
          
          const headers = this.getAuthHeaders();
          console.log('üéØ Headers preparados:', headers);
          
          const url = `${API_BASE_URL}/eventos`;
          console.log('üéØ URL a llamar:', url);
          
          const response = await fetch(url, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(eventoData)
          });

          console.log('üéØ Respuesta recibida:', response.status, response.statusText);
          
          const data = await response.json();
          
          console.log('üì¶ Datos de respuesta:', data);
          
          if (!response.ok) {
            throw new Error(data.message || 'Error creando evento');
          }

          return data;
        } catch (error) {
          console.error('‚ùå Error en EventoService.createEvento():', error);
          return {
            success: false,
            message: error instanceof Error ? error.message : 'Error de conexi√≥n con el servidor'
          };
        }
      },

      async deleteEvento(eventoId) {
        try {
          console.log('üóëÔ∏è EventoService.deleteEvento() iniciado con ID:', eventoId);
          
          const headers = this.getAuthHeaders();
          console.log('üóëÔ∏è Headers preparados:', headers);
          
          const url = `${API_BASE_URL}/eventos/${eventoId}`;
          console.log('üóëÔ∏è URL a llamar:', url);
          
          const response = await fetch(url, {
            method: 'DELETE',
            headers: headers
          });

          console.log('üóëÔ∏è Respuesta recibida:', response.status, response.statusText);
          
          const data = await response.json();
          
          console.log('üì¶ Datos de respuesta:', data);
          
          if (!response.ok) {
            throw new Error(data.message || 'Error eliminando evento');
          }

          return data;
        } catch (error) {
          console.error('‚ùå Error en EventoService.deleteEvento():', error);
          return {
            success: false,
            message: error instanceof Error ? error.message : 'Error de conexi√≥n con el servidor'
          };
        }
      },

      async updateEvento(eventoId, eventoData) {
        try {
          console.log('üìù EventoService.updateEvento() iniciado con ID:', eventoId);
          console.log('üìù Datos a enviar:', eventoData);
          
          const headers = this.getAuthHeaders();
          console.log('üìù Headers preparados:', headers);
          
          const url = `${API_BASE_URL}/eventos/${eventoId}`;
          console.log('üìù URL a llamar:', url);
          
          const response = await fetch(url, {
            method: 'PUT',
            headers: headers,
            body: JSON.stringify(eventoData)
          });

          console.log('üìù Respuesta recibida:', response.status, response.statusText);
          
          const data = await response.json();
          
          console.log('üì¶ Datos de respuesta:', data);
          
          if (!response.ok) {
            throw new Error(data.message || 'Error actualizando evento');
          }

          return data;
        } catch (error) {
          console.error('‚ùå Error en EventoService.updateEvento():', error);
          return {
            success: false,
            message: error instanceof Error ? error.message : 'Error de conexi√≥n con el servidor'
          };
        }
      }
    };

    window.addEventListener('error', (event) => {
      console.error('üö® Error JavaScript detectado:', {
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        error: event.error
      });
    });

    window.addEventListener('unhandledrejection', (event) => {
      console.error('üö® Promise rejection no manejada:', event.reason);
    });

    let events = [];
    let isModalOpen = false;
    let isLoading = false;
    let loadingTimeout = null;
    let organizacionData = null;

    function getAuthToken() {
      return localStorage.getItem('organizacionAuthToken');
    }

    function checkAuth() {
      console.log('üîç Iniciando verificaci√≥n de autenticaci√≥n...');
      
      const token = getAuthToken();
      console.log('üîë Token encontrado:', token ? 'S√ç' : 'NO');
      console.log('üîë Longitud del token:', token ? token.length : 0);
      
      if (!token) {
        console.log('‚ùå No se encontr√≥ token de organizaci√≥n, redirigiendo al login...');
        window.location.href = '/login-organizacion';
        return false;
      }
      
      console.log('‚úÖ Token presente, continuando...');
      return true;
    }

    async function loadProfile() {
      try {
        console.log('üë§ Cargando perfil de la organizaci√≥n...');
        
        const response = await OrganizacionService.getProfile();
        
        if (response.success && response.data) {
          organizacionData = response.data;
          console.log('‚úÖ Perfil cargado exitosamente:', organizacionData);
          
          // Actualizar el t√≠tulo de bienvenida
          updateWelcomeMessage();
        } else {
          console.log('‚ùå Error cargando perfil:', response.message);
          throw new Error(response.message || 'Error desconocido al cargar perfil');
        }
      } catch (error) {
        console.error('‚ùå Error cargando perfil de organizaci√≥n:', error);
        // Si hay error cargando el perfil, usar un mensaje gen√©rico
        updateWelcomeMessage('Organizaci√≥n');
      }
    }

    function updateWelcomeMessage(fallbackName = null) {
      const welcomeTitle = document.querySelector('h1.text-4xl.font-bold.text-white.mb-4');
      if (welcomeTitle) {
        let nombreMostrar = fallbackName;
        
        if (organizacionData && organizacionData.nombreRepresentante) {
          nombreMostrar = organizacionData.nombreRepresentante;
        }
        
        if (nombreMostrar) {
          welcomeTitle.textContent = `Bienvenido ${nombreMostrar}`;
        } else {
          welcomeTitle.textContent = 'Bienvenido a tu Dashboard';
        }
        
        console.log('üé® T√≠tulo de bienvenida actualizado:', welcomeTitle.textContent);
      }

      // Tambi√©n actualizar el navbar para mostrar el nombre de la organizaci√≥n
      const navTitle = document.querySelector('h1.text-xl.font-bold.text-purple-600');
      if (navTitle && organizacionData) {
        if (organizacionData.nombre) {
          navTitle.textContent = organizacionData.nombre;
          console.log('üé® T√≠tulo del navbar actualizado:', navTitle.textContent);
        }
      }
    }

    function showLoadingState() {
      const container = document.getElementById('eventos-container');
      if (container) {
        container.innerHTML = `
          <div id="loading-state" class="text-center py-12">
            <div class="animate-pulse">
              <div class="w-12 h-12 bg-purple-200 rounded-full mx-auto mb-4 animate-bounce"></div>
              <div class="h-4 bg-purple-200 rounded w-48 mx-auto mb-2"></div>
              <div class="h-3 bg-purple-200 rounded w-32 mx-auto"></div>
            </div>
            <p class="text-purple-600 mt-4 font-medium">Cargando eventos...</p>
          </div>
        `;
      }

      if (loadingTimeout) {
        clearTimeout(loadingTimeout);
      }
      
      loadingTimeout = setTimeout(() => {
        if (isLoading) {
          showTimeoutMessage();
        }
      }, 15000);
    }

    function showTimeoutMessage() {
      const container = document.getElementById('eventos-container');
      if (container) {
        container.innerHTML = `
          <div class="text-center py-12">
            <svg class="mx-auto text-orange-500 mb-4 w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <h3 class="text-xl font-semibold text-orange-600 mb-2">M√≥dulo a la espera de informaci√≥n</h3>
            <p class="text-orange-500 mb-4">La carga est√° tomando m√°s tiempo del esperado</p>
            <p class="text-gray-600 text-sm mb-6">Comun√≠quese con el administrador si el problema persiste</p>
            <button onclick="loadEvents()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm font-medium transition-colors">
              Reintentar
            </button>
          </div>
        `;
      }
      isLoading = false;
    }

    function showNoEventsMessage() {
      const container = document.getElementById('eventos-container');
      if (container) {
        container.innerHTML = `
          <div class="text-center py-12">
            <svg class="mx-auto text-gray-400 mb-4 w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4m-4 1v2m0 0V8m0 2.5-4-4m4 4 4-4"></path>
            </svg>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">A√∫n no se han creado eventos</h3>
            <p class="text-gray-500 mb-6">Comienza creando tu primer evento para gestionar voluntarios</p>
            <button onclick="openEventModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm font-medium transition-colors flex items-center mx-auto">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Crear Primer Evento
            </button>
          </div>
        `;
      }
    }

    async function loadEvents() {
      if (isLoading) {
        console.log('‚è≥ Ya hay una carga de eventos en progreso, saltando...');
        return;
      }
      
      isLoading = true;
      showLoadingState();
      
      const btnNuevoEvento = document.getElementById('nuevo-evento-btn');
      if (btnNuevoEvento) {
        btnNuevoEvento.disabled = true;
      }

      try {
        console.log('üìã Cargando eventos desde el backend...');
        console.log('üîë Token actual:', localStorage.getItem('organizacionAuthToken') ? 'PRESENTE' : 'AUSENTE');
        
        console.log('üîß EventoService disponible:', typeof EventoService !== 'undefined');
        console.log('üîß getEventos method disponible:', typeof EventoService?.getEventos === 'function');
        
        const response = await EventoService.getEventos();
        
        console.log('üì¶ Respuesta completa del EventoService.getEventos():', response);
        
        if (response.success && response.data) {
          events = response.data.eventos || [];
          console.log(`‚úÖ ${events.length} eventos cargados exitosamente`);
          console.log('üìã Eventos:', events);
        } else {
          console.log('‚ùå Respuesta no exitosa:', response);
          throw new Error(response.message || 'Error desconocido al cargar eventos');
        }

        if (loadingTimeout) {
          clearTimeout(loadingTimeout);
          loadingTimeout = null;
        }

        console.log('üé® Renderizando eventos...');
        renderEvents();
        updateStats();

      } catch (error) {
        console.error('‚ùå Error completo al cargar eventos:', error);
        console.error('‚ùå Stack trace:', error.stack);
        
        if (loadingTimeout) {
          clearTimeout(loadingTimeout);
          loadingTimeout = null;
        }
        
        showError(`Error de conexi√≥n con el servidor: ${error.message}`);
      } finally {
        isLoading = false;
        
        if (btnNuevoEvento) {
          btnNuevoEvento.disabled = false;
        }
        
        console.log('üèÅ Funci√≥n loadEvents terminada, isLoading =', isLoading);
      }
    }

    function renderEvents() {
      const container = document.getElementById('eventos-container');
      if (!container) return;

      if (events.length === 0) {
        container.innerHTML = `
          <div class="text-center py-12">
            <svg class="mx-auto text-gray-400 mb-4 w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4m-4 1v2m0 0V8m0 2.5-4-4m4 4 4-4"></path>
            </svg>
            <h3 class="text-lg font-medium text-gray-600 mb-2">No hay eventos creados</h3>
            <p class="text-gray-500">Crea tu primer evento haciendo clic en "Nuevo Evento"</p>
          </div>
        `;
      } else {
        container.innerHTML = `
          <div class="space-y-4">
            ${events.map(event => createEventCard(event)).join('')}
          </div>
        `;
      }
    }

    function createEventCard(event) {
      const status = getEventStatus(event.fechaInicio, event.fechaFin);
      const statusClass = getStatusClass(status.color);
      
      return `
        <div class="border border-gray-200 rounded-lg p-6 bg-white hover:shadow-md transition-shadow">
          <div class="flex justify-between items-start mb-4">
            <div class="flex-1">
              <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-semibold text-gray-800">${event.titulo}</h3>
                <span class="${statusClass}">${status.status}</span>
              </div>
              
              ${event.categoria_nombre ? `
                <div class="flex items-center text-purple-600 text-sm mb-2">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                  </svg>
                  ${event.categoria_nombre}
                </div>
              ` : ''}
              
              <p class="text-gray-600 text-sm mb-3">${event.descripcion}</p>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
            <div class="flex items-center text-gray-600">
              <svg class="w-4 h-4 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4m-4 1v2m0 0V8m0 2.5-4-4m4 4 4-4"></path>
              </svg>
              <div>
                <div class="font-medium">Inicio</div>
                <div>${formatDate(event.fechaInicio)}</div>
                <div class="text-xs">${formatTime(event.horaInicio)}</div>
              </div>
            </div>

            <div class="flex items-center text-gray-600">
              <svg class="w-4 h-4 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div>
                <div class="font-medium">Fin</div>
                <div>${formatDate(event.fechaFin)}</div>
                <div class="text-xs">${formatTime(event.horaFin)}</div>
              </div>
            </div>

            <div class="flex items-center text-gray-600">
              <svg class="w-4 h-4 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <div>
                <div class="font-medium">Ubicaci√≥n</div>
                <div class="text-xs">${event.ubicacion || 'No especificada'}</div>
              </div>
            </div>

            <div class="flex items-center text-gray-600">
              <svg class="w-4 h-4 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
              </svg>
              <div>
                <div class="font-medium">Participantes</div>
                <div>${event.participantesRegistrados || 0} / ${event.capacidadMaxima || 'Ilimitado'}</div>
                <div class="text-xs">${event.capacidadMaxima ? (event.capacidadMaxima - (event.participantesRegistrados || 0)) + ' disponibles' : 'Sin l√≠mite'}</div>
              </div>
            </div>
          </div>

          ${event.requisitos && event.requisitos.length > 0 ? `
            <div class="mt-4 pt-4 border-t border-gray-100">
              <div class="text-sm text-gray-600 mb-2">
                <strong>Requisitos:</strong>
              </div>
              <div class="flex flex-wrap gap-2">
                ${(() => {
                  try {
                    let requisitosArray = [];
                    if (typeof event.requisitos === 'string') {
                      let cleanRequisitos = event.requisitos
                        .replace(/^\{+/, '')
                        .replace(/\}+$/, '')
                        .replace(/["']/g, '')
                        .trim();
                      
                      if (cleanRequisitos.includes(',')) {
                        requisitosArray = cleanRequisitos.split(',').map(r => r.trim());
                      } else if (cleanRequisitos) {
                        requisitosArray = [cleanRequisitos];
                      }
                    } else if (Array.isArray(event.requisitos)) {
                      requisitosArray = event.requisitos;
                    } else if (event.requisitos) {
                      requisitosArray = [String(event.requisitos)];
                    }
                    
                    return requisitosArray
                      .filter(req => req && req.trim() !== '')
                      .map(req => `
                        <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs">${req.trim()}</span>
                      `).join('');
                  } catch (e) {
                    console.error('Error procesando requisitos:', e);
                    return `<span class="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs">${event.requisitos}</span>`;
                  }
                })()}
              </div>
            </div>
          ` : ''}

          <!-- Botones de Acci√≥n -->
          <div class="mt-4 pt-4 border-t border-gray-100 flex justify-end space-x-2">
            <button 
              onclick="editEvent(${event.id || event.evento_id})" 
              class="inline-flex items-center px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
              title="Editar evento"
            >
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              Editar
            </button>
            <button 
              onclick="deleteEvent(${event.id || event.evento_id})" 
              class="inline-flex items-center px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
              title="Eliminar evento"
            >
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
              Eliminar
            </button>
          </div>
        </div>
      `;
    }

    function getEventStatus(fechaInicio, fechaFin) {
      const now = new Date();
      const start = new Date(fechaInicio);
      const end = new Date(fechaFin);

      if (now < start) {
        return { status: 'Pr√≥ximo', color: 'blue' };
      } else if (now >= start && now <= end) {
        return { status: 'En Curso', color: 'green' };
      } else {
        return { status: 'Finalizado', color: 'gray' };
      }
    }

    function getStatusClass(color) {
      const classes = {
        blue: 'bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium',
        green: 'bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium',
        gray: 'bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-medium'
      };
      return classes[color] || classes.gray;
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('es-ES', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    }

    function formatTime(timeString) {
      if (!timeString) {
        return 'Hora no especificada';
      }
      
      if (timeString.includes('T')) {
        const date = new Date(timeString);
        return date.toLocaleTimeString('es-ES', {
          hour: '2-digit',
          minute: '2-digit'
        });
      }
      
      if (timeString.includes(':')) {
        const [hours, minutes] = timeString.split(':');
        const date = new Date();
        date.setHours(parseInt(hours), parseInt(minutes));
        return date.toLocaleTimeString('es-ES', {
          hour: '2-digit',
          minute: '2-digit'
        });
      }
      
      return timeString;
    }

    function updateStats() {
      console.log('üîÑ Actualizando estad√≠sticas con', events.length, 'eventos');
      
      const now = new Date();
      
      // Eventos activos: eventos que est√°n en curso (entre fecha_inicio y fecha_fin)
      const eventosActivos = events.filter(event => {
        try {
          // Manejar diferentes formatos de fecha
          let start, end;
          
          if (event.fechaInicio) {
            start = new Date(event.fechaInicio);
          } else if (event.fecha_inicio) {
            start = new Date(event.fecha_inicio);
          }
          
          if (event.fechaFin) {
            end = new Date(event.fechaFin);
          } else if (event.fecha_fin) {
            end = new Date(event.fecha_fin);
          }
          
          // Validar fechas
          if (!start || !end || isNaN(start.getTime()) || isNaN(end.getTime())) {
            console.warn('Fechas inv√°lidas para evento:', event.id || event.titulo);
            return false;
          }
          
          const isActive = now >= start && now <= end;
          const isActiveStatus = !event.estado || event.estado === 'activo' || event.estado === 'planificado';
          
          return isActive && isActiveStatus;
        } catch (error) {
          console.error('Error procesando evento activo:', event.id || event.titulo, error);
          return false;
        }
      }).length;

      // Eventos completados: eventos que ya terminaron
      const eventosCompletados = events.filter(event => {
        try {
          let end;
          
          if (event.fechaFin) {
            end = new Date(event.fechaFin);
          } else if (event.fecha_fin) {
            end = new Date(event.fecha_fin);
          }
          
          if (!end || isNaN(end.getTime())) {
            return false;
          }
          
          return now > end || event.estado === 'completado';
        } catch (error) {
          console.error('Error procesando evento completado:', event.id || event.titulo, error);
          return false;
        }
      }).length;

      // Total de voluntarios registrados (suma de todos los voluntarios_inscritos)
      const totalVoluntarios = events.reduce((sum, event) => {
        if (event.voluntarios_inscritos && Array.isArray(event.voluntarios_inscritos)) {
          return sum + event.voluntarios_inscritos.length;
        }
        return sum;
      }, 0);

      // Estimaci√≥n de horas de voluntariado (asumiendo 4 horas promedio por evento por voluntario)
      const horasVoluntariado = events.reduce((sum, event) => {
        if (event.voluntarios_inscritos && Array.isArray(event.voluntarios_inscritos)) {
          // Calcular horas basado en duraci√≥n del evento
          const start = new Date(event.fecha_inicio);
          const end = new Date(event.fecha_fin);
          const duracionHoras = Math.max(1, Math.round((end - start) / (1000 * 60 * 60))); // M√≠nimo 1 hora
          return sum + (event.voluntarios_inscritos.length * duracionHoras);
        }
        return sum;
      }, 0);

      // Actualizar elementos DOM con validaci√≥n
      const eventosActivosEl = document.getElementById('eventos-activos');
      const eventosCompletadosEl = document.getElementById('eventos-completados');
      const voluntariosRegistradosEl = document.getElementById('voluntarios-registrados');
      const horasVoluntariadoEl = document.getElementById('horas-voluntariado');

      // Validar que los valores sean n√∫meros v√°lidos
      const eventosActivosValor = isNaN(eventosActivos) ? 0 : eventosActivos;
      const eventosCompletadosValor = isNaN(eventosCompletados) ? 0 : eventosCompletados;
      const totalVoluntariosValor = isNaN(totalVoluntarios) ? 0 : totalVoluntarios;
      const horasVoluntariadoValor = isNaN(horasVoluntariado) ? 0 : horasVoluntariado;

      if (eventosActivosEl) eventosActivosEl.textContent = eventosActivosValor.toString();
      if (eventosCompletadosEl) eventosCompletadosEl.textContent = eventosCompletadosValor.toString();
      if (voluntariosRegistradosEl) voluntariosRegistradosEl.textContent = totalVoluntariosValor.toString();
      if (horasVoluntariadoEl) horasVoluntariadoEl.textContent = horasVoluntariadoValor.toString();

      console.log('üìä Estad√≠sticas actualizadas:', {
        eventosActivos: eventosActivosValor,
        eventosCompletados: eventosCompletadosValor,
        totalVoluntarios: totalVoluntariosValor,
        horasVoluntariado: horasVoluntariadoValor
      });
    }

    function showError(message) {
      const container = document.getElementById('eventos-container');
      if (container) {
        container.innerHTML = `
          <div class="text-center py-12">
            <svg class="mx-auto text-red-400 mb-4 w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <h3 class="text-lg font-medium text-red-600 mb-2">Error</h3>
            <p class="text-red-500">${message}</p>
            <button onclick="loadEvents()" class="mt-4 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
              Reintentar
            </button>
          </div>
        `;
      }
    }

    async function createEvent(eventData) {
      console.log('üéØ Iniciando creaci√≥n de evento:', eventData);
      
      if (!checkAuth()) return;
      
      try {
        const fechaInicio = `${eventData.fecha_inicio}T${eventData.hora_inicio}:00`;
        const fechaFin = `${eventData.fecha_fin}T${eventData.hora_fin}:00`;
        
        const dataParaEnviar = {
          titulo: eventData.titulo,
          descripcion: eventData.descripcion,
          fechaInicio,
          fechaFin,
          ubicacion: eventData.direccion,
          tipoEvento: 'voluntariado',
          capacidadMaxima: parseInt(eventData.capacidad_maxima) || null,
          requisitos: eventData.requisitos || '',
          categoria_id: eventData.categoria_id || 1
        };
        
        console.log('üì§ Datos a enviar:', dataParaEnviar);
        
        const response = await EventoService.createEvento(dataParaEnviar);
        
        if (response.success) {
          console.log('‚úÖ Evento creado exitosamente');
          
          closeEventModal();
          
          const form = document.getElementById('event-form');
          if (form) form.reset();
          
          await loadEvents();
          
          showSuccessMessage('¬°Evento creado exitosamente!');
        } else {
          throw new Error(response.message || 'Error desconocido al crear evento');
        }
      } catch (error) {
        console.error('‚ùå Error creando evento:', error);
        showErrorMessage(`Error al crear evento: ${error.message}`);
      }
    }

    function showSuccessMessage(message) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 3000);
    }

    function showErrorMessage(message) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 3000);
    }

    function openEventModal() {
      if (isLoading) return;
      
      isModalOpen = true;
      const modal = document.getElementById('event-modal');
      if (modal) {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
    }

    function closeEventModal() {
      isModalOpen = false;
      const modal = document.getElementById('event-modal');
      if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }
      
      const form = document.getElementById('event-form');
      if (form) {
        form.reset();
      }
    }

    let eventToEdit = null;

    function editEvent(eventId) {
      console.log('Editar evento:', eventId);
      
      // Encontrar el evento en la lista
      const event = events.find(e => (e.id || e.evento_id) == eventId);
      if (!event) {
        console.error('Evento no encontrado:', eventId);
        showErrorMessage('Evento no encontrado');
        return;
      }
      
      console.log('üîß Evento a editar:', event);
      
      // Guardar referencia del evento a editar
      eventToEdit = event;
      
      // Llenar los campos del modal con los datos del evento
      fillEditEventForm(event);
      
      // Mostrar el modal
      openEditEventModal();
    }

    async function updateEvent(formData) {
      if (!eventToEdit) {
        console.error('No hay evento seleccionado para editar');
        return;
      }

      const eventId = eventToEdit.id || eventToEdit.evento_id;
      console.log('üìù Iniciando actualizaci√≥n del evento ID:', eventId);
      
      if (!checkAuth()) return;
      
      try {
        // Construir las fechas completas con hora
        const fechaInicio = `${formData.fecha_inicio}T${formData.hora_inicio}:00`;
        const fechaFin = `${formData.fecha_fin}T${formData.hora_fin}:00`;
        
        const dataParaEnviar = {
          titulo: formData.titulo,
          descripcion: formData.descripcion,
          fechaInicio,
          fechaFin,
          capacidadMaxima: parseInt(formData.capacidad_maxima) || null,
          requisitos: formData.requisitos || ''
        };
        
        console.log('üì§ Datos a enviar para actualizaci√≥n:', dataParaEnviar);
        
        const response = await EventoService.updateEvento(eventId, dataParaEnviar);
        
        if (response.success) {
          console.log('‚úÖ Evento actualizado exitosamente');
          
          // Cerrar modal
          closeEditEventModal();
          
          // Recargar eventos para mostrar los cambios
          await loadEvents();
          
          showSuccessMessage('¬°Evento actualizado exitosamente!');
        } else {
          throw new Error(response.message || 'Error desconocido al actualizar evento');
        }
      } catch (error) {
        console.error('‚ùå Error actualizando evento:', error);
        showErrorMessage(`Error al actualizar evento: ${error.message}`);
      }
    }

    function fillEditEventForm(event) {
      // Campos editables
      document.getElementById('edit-titulo').value = event.titulo || '';
      document.getElementById('edit-descripcion').value = event.descripcion || '';
      
      // Fechas - usar solo la parte de fecha
      if (event.fechaInicio || event.fecha_inicio) {
        const fechaInicio = new Date(event.fechaInicio || event.fecha_inicio);
        document.getElementById('edit-fecha-inicio').value = fechaInicio.toISOString().split('T')[0];
      }
      
      if (event.fechaFin || event.fecha_fin) {
        const fechaFin = new Date(event.fechaFin || event.fecha_fin);
        document.getElementById('edit-fecha-fin').value = fechaFin.toISOString().split('T')[0];
      }

      // Horas - usar los campos separados de hora de la base de datos
      if (event.horaInicio || event.hora_inicio) {
        document.getElementById('edit-hora-inicio').value = event.horaInicio || event.hora_inicio;
      }
      
      if (event.horaFin || event.hora_fin) {
        document.getElementById('edit-hora-fin').value = event.horaFin || event.hora_fin;
      }
      
      document.getElementById('edit-capacidad-maxima').value = event.capacidadMaxima || event.capacidad_maxima || '';
      
      // Requisitos - manejar diferentes formatos
      let requisitosTexto = '';
      if (event.requisitos) {
        if (Array.isArray(event.requisitos)) {
          requisitosTexto = event.requisitos.join(', ');
        } else if (typeof event.requisitos === 'string') {
          requisitosTexto = event.requisitos
            .replace(/^\{+/, '')
            .replace(/\}+$/, '')
            .replace(/["']/g, '')
            .trim();
        }
      }
      document.getElementById('edit-requisitos').value = requisitosTexto;
      
      // Campos no editables (solo para mostrar)
      document.getElementById('edit-categoria').value = event.categoria_id || '';
      document.getElementById('edit-direccion').value = event.ubicacion || event.direccion || '';
    }

    function openEditEventModal() {
      const modal = document.getElementById('edit-event-modal');
      if (modal) {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
      }
    }

    function closeEditEventModal() {
      const modal = document.getElementById('edit-event-modal');
      if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';
      }
      
      // Limpiar el formulario
      const form = document.getElementById('edit-event-form');
      if (form) {
        form.reset();
      }
    }

    let eventToDelete = null;

    function deleteEvent(eventId) {
      console.log('Solicitud de eliminar evento:', eventId);
      
      // Encontrar el evento en la lista
      const event = events.find(e => (e.id || e.evento_id) == eventId);
      if (!event) {
        console.error('Evento no encontrado:', eventId);
        showErrorMessage('Evento no encontrado');
        return;
      }
      
      // Guardar referencia del evento a eliminar
      eventToDelete = event;
      
      // Mostrar informaci√≥n del evento en el modal
      const titleElement = document.getElementById('event-title-to-delete');
      const dateElement = document.getElementById('event-date-to-delete');
      
      if (titleElement) {
        titleElement.textContent = event.titulo || 'Sin t√≠tulo';
      }
      
      if (dateElement) {
        const startDate = formatDate(event.fechaInicio || event.fecha_inicio);
        const endDate = formatDate(event.fechaFin || event.fecha_fin);
        dateElement.textContent = `${startDate} - ${endDate}`;
      }
      
      // Mostrar el modal
      showDeleteEventModal();
    }

    function showDeleteEventModal() {
      const modal = document.getElementById('delete-event-modal');
      if (modal) {
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
      }
    }

    function hideDeleteEventModal() {
      const modal = document.getElementById('delete-event-modal');
      if (modal) {
        modal.classList.remove('show');
        document.body.style.overflow = '';
      }
      eventToDelete = null;
    }

    async function confirmDeleteEvent() {
      if (!eventToDelete) {
        console.error('No hay evento seleccionado para eliminar');
        return;
      }
      
      const eventId = eventToDelete.id || eventToDelete.evento_id;
      console.log('Confirmando eliminaci√≥n del evento:', eventId);
      
      // Deshabilitar el bot√≥n de confirmar
      const confirmBtn = document.getElementById('confirm-delete-event');
      if (confirmBtn) {
        confirmBtn.disabled = true;
        confirmBtn.innerHTML = `
          <svg class="w-4 h-4 mr-1 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12a8 8 0 01.09-1.17A8 8 0 018 4a8 8 0 01.17-.09A8 8 0 0112 4a8 8 0 01.17.09A8 8 0 0120 12a8 8 0 01-.09 1.17A8 8 0 0116 20a8 8 0 01-.17.09A8 8 0 0112 20a8 8 0 01-.17-.09A8 8 0 014 12z"></path>
          </svg>
          Eliminando...
        `;
      }
      
      try {
        // Llamar al backend para eliminar el evento
        console.log('üóëÔ∏è Iniciando eliminaci√≥n del evento ID:', eventId);
        const response = await EventoService.deleteEvento(eventId);
        
        console.log('üóëÔ∏è Respuesta del servidor:', response);
        
        if (!response.success) {
          throw new Error(response.message || 'Error eliminando evento');
        }
        
        // Eliminar el evento de la lista local
        const eventIndex = events.findIndex(e => (e.id || e.evento_id) == eventId);
        if (eventIndex !== -1) {
          events.splice(eventIndex, 1);
          console.log('‚úÖ Evento eliminado de la lista local');
        }
        
        // Cerrar modal
        hideDeleteEventModal();
        
        // Actualizar la vista
        renderEvents();
        updateStats();
        
        // Mostrar mensaje de √©xito
        const mensaje = response.data?.voluntariosAfectados > 0 
          ? `Evento eliminado exitosamente. Se desregistraron ${response.data.voluntariosAfectados} voluntarios.`
          : 'Evento eliminado exitosamente';
          
        showSuccessMessage(mensaje);
        
      } catch (error) {
        console.error('‚ùå Error eliminando evento:', error);
        showErrorMessage(`Error al eliminar evento: ${error.message}`);
      } finally {
        // Restaurar el bot√≥n
        if (confirmBtn) {
          confirmBtn.disabled = false;
          confirmBtn.innerHTML = `
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
            Eliminar Evento
          `;
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ Dashboard de organizaci√≥n cargando...');
      console.log('üìä LocalStorage actual:', {
        organizacionAuthToken: localStorage.getItem('organizacionAuthToken') ? 'Presente' : 'Ausente',
        organizacion: localStorage.getItem('organizacion') ? 'Presente' : 'Ausente',
        token: localStorage.getItem('token') ? 'Presente' : 'Ausente'
      });
      
      console.log('üîí Verificando autenticaci√≥n...');
      if (!checkAuth()) {
        console.log('‚ùå Autenticaci√≥n fall√≥, deteniendo carga del dashboard');
        return;
      }

      console.log('‚úÖ Autenticaci√≥n exitosa, continuando con la carga...');

      // Cargar perfil de la organizaci√≥n primero
      console.log('üë§ Iniciando carga del perfil...');
      loadProfile();

      console.log('üìÖ Iniciando carga de eventos...');
      loadEvents();

      const nuevoEventoBtn = document.getElementById('nuevo-evento-btn');
      if (nuevoEventoBtn) {
        console.log('üîò Configurando bot√≥n de nuevo evento...');
        nuevoEventoBtn.addEventListener('click', () => {
          console.log('üîò Click en nuevo evento');
          openEventModal();
        });
      } else {
        console.log('‚ö†Ô∏è No se encontr√≥ el bot√≥n de nuevo evento');
      }

      const modal = document.getElementById('event-modal');
      if (modal) {
        console.log('üîò Configurando modal de eventos...');
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            closeEventModal();
          }
        });
      }

      const closeBtn = document.getElementById('close-modal-btn');
      if (closeBtn) {
        closeBtn.addEventListener('click', closeEventModal);
      }

      const eventForm = document.getElementById('event-form');
      if (eventForm) {
        eventForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const formData = new FormData(eventForm);
          const eventData = {
            titulo: formData.get('titulo'),
            descripcion: formData.get('descripcion'),
            categoria_id: parseInt(formData.get('categoria_id')),
            fecha_inicio: formData.get('fecha_inicio'),
            hora_inicio: formData.get('hora_inicio'),
            fecha_fin: formData.get('fecha_fin'),
            hora_fin: formData.get('hora_fin'),
            direccion: formData.get('direccion'),
            capacidad_maxima: parseInt(formData.get('capacidad_maxima')),
            requisitos: formData.get('requisitos') ? formData.get('requisitos').split(',').map(req => req.trim()) : []
          };
          
          await createEvent(eventData);
        });
      }

      // Configurar modal de eliminaci√≥n de eventos
      const cancelDeleteBtn = document.getElementById('cancel-delete-event');
      const confirmDeleteBtn = document.getElementById('confirm-delete-event');
      const deleteModal = document.getElementById('delete-event-modal');

      if (cancelDeleteBtn) {
        cancelDeleteBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Eliminaci√≥n cancelada');
          hideDeleteEventModal();
        });
      }

      if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Eliminaci√≥n confirmada');
          confirmDeleteEvent();
        });
      }

      // Cerrar modal de eliminaci√≥n al hacer clic fuera
      if (deleteModal) {
        deleteModal.addEventListener('click', function(e) {
          if (e.target === deleteModal) {
            hideDeleteEventModal();
          }
        });
      }

      // Cerrar modal de eliminaci√≥n con escape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && deleteModal && deleteModal.classList.contains('show')) {
          hideDeleteEventModal();
        }
      });

      // Configurar modal de edici√≥n de eventos
      const closeEditBtn = document.getElementById('close-edit-modal-btn');
      const editModal = document.getElementById('edit-event-modal');
      const editForm = document.getElementById('edit-event-form');

      if (closeEditBtn) {
        closeEditBtn.addEventListener('click', function(e) {
          e.preventDefault();
          closeEditEventModal();
        });
      }

      if (editModal) {
        editModal.addEventListener('click', function(e) {
          if (e.target === editModal) {
            closeEditEventModal();
          }
        });
      }

      if (editForm) {
        editForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          console.log('üìù Formulario de edici√≥n enviado');
          
          // Deshabilitar el bot√≥n de env√≠o
          const submitBtn = editForm.querySelector('button[type="submit"]');
          if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
              <svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12a8 8 0 01.09-1.17A8 8 0 018 4a8 8 0 01.17-.09A8 8 0 0112 4a8 8 0 01.17.09A8 8 0 0120 12a8 8 0 01-.09 1.17A8 8 0 0116 20a8 8 0 01-.17.09A8 8 0 0112 20a8 8 0 01-.17-.09A8 8 0 014 12z"></path>
              </svg>
              Actualizando...
            `;
          }
          
          try {
            // Recoger datos del formulario
            const formData = new FormData(editForm);
            const eventData = {
              titulo: formData.get('titulo'),
              descripcion: formData.get('descripcion'),
              fecha_inicio: formData.get('fecha_inicio'),
              hora_inicio: formData.get('hora_inicio'),
              fecha_fin: formData.get('fecha_fin'),
              hora_fin: formData.get('hora_fin'),
              capacidad_maxima: formData.get('capacidad_maxima'),
              requisitos: formData.get('requisitos')
            };
            
            console.log('üìã Datos del formulario recolectados:', eventData);
            
            // Llamar a la funci√≥n de actualizaci√≥n
            await updateEvent(eventData);
            
          } catch (error) {
            console.error('‚ùå Error en el submit del formulario:', error);
            showErrorMessage(`Error al procesar formulario: ${error.message}`);
          } finally {
            // Restaurar el bot√≥n
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.innerHTML = `
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                Editar Evento
              `;
            }
          }
        });
      }

      // Cerrar modal de edici√≥n con escape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && editModal && !editModal.classList.contains('hidden')) {
          closeEditEventModal();
        }
      });
      
      console.log('üéâ Dashboard completamente cargado');
    });

    window.loadEvents = loadEvents;
    window.createEvent = createEvent;
    window.openEventModal = openEventModal;
    window.closeEventModal = closeEventModal;
    window.editEvent = editEvent;
    window.openEditEventModal = openEditEventModal;
    window.closeEditEventModal = closeEditEventModal;
    window.deleteEvent = deleteEvent;
    window.showDeleteEventModal = showDeleteEventModal;
    window.hideDeleteEventModal = hideDeleteEventModal;
    window.confirmDeleteEvent = confirmDeleteEvent;

    // Logout Modal Functions
    function showLogoutModal() {
      const modal = document.getElementById('logout-modal');
      if (modal) {
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
      }
    }

    function hideLogoutModal() {
      const modal = document.getElementById('logout-modal');
      if (modal) {
        modal.classList.remove('show');
        document.body.style.overflow = '';
      }
    }

    function performLogout() {
      console.log('Performing organization logout...');
      
      // Deshabilitar el bot√≥n de confirmar
      const confirmBtn = document.getElementById('confirm-logout');
      if (confirmBtn) {
        confirmBtn.disabled = true;
        confirmBtn.textContent = 'Cerrando...';
      }

      // Intentar logout en el backend (sin esperar respuesta)
      const token = localStorage.getItem('organizationAuthToken') || localStorage.getItem('authToken');
      if (token) {
        fetch('http://localhost:3001/api/auth/logout', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
        }).catch(err => console.log('Backend logout error (ignored):', err));
      }
      
      // Limpiar datos y redirigir
      setTimeout(() => {
        localStorage.clear();
        sessionStorage.clear();
        console.log('Redirecting to organization login...');
        window.location.replace('/login-organizacion');
      }, 500);
    }

    function initLogoutButton() {
      console.log('Initializing organization logout button...');
      
      const logoutBtn = document.getElementById('logout-btn');
      const cancelBtn = document.getElementById('cancel-logout');
      const confirmBtn = document.getElementById('confirm-logout');
      const modal = document.getElementById('logout-modal');
      
      console.log('Logout button found:', logoutBtn);
      
      if (logoutBtn && !logoutBtn.hasAttribute('data-logout-initialized')) {
        console.log('Setting up logout button event listener');
        logoutBtn.setAttribute('data-logout-initialized', 'true');
        
        // Evento para abrir el modal
        logoutBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('Logout button clicked - showing modal');
          showLogoutModal();
        });

        // Evento para cancelar
        if (cancelBtn) {
          cancelBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Logout canceled');
            hideLogoutModal();
          });
        }

        // Evento para confirmar
        if (confirmBtn) {
          confirmBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Logout confirmed');
            performLogout();
          });
        }

        // Cerrar modal al hacer clic fuera
        if (modal) {
          modal.addEventListener('click', function(e) {
            if (e.target === modal) {
              hideLogoutModal();
            }
          });
        }

        // Cerrar modal con escape
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && modal && modal.classList.contains('show')) {
            hideLogoutModal();
          }
        });

        return true;
      }
      
      return false;
    }

    // Initialize logout functionality
    const logoutObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.type === 'childList') {
          mutation.addedNodes.forEach((node) => {
            if (node.nodeType === 1) {
              const logoutBtn = node.id === 'logout-btn' ? node : node.querySelector('#logout-btn');
              if (logoutBtn) {
                console.log('üîç Logout button detected via MutationObserver');
                const success = initLogoutButton();
                if (success) {
                  console.log('‚úÖ Logout button initialized successfully');
                }
              }
            }
          });
        }
      });
    });

    // Configurar el observer
    logoutObserver.observe(document.body, {
      childList: true,
      subtree: true
    });

    // Intentar inicializar inmediatamente
    setTimeout(() => {
      console.log('üöÄ Attempting immediate logout button initialization');
      initLogoutButton();
    }, 100);
  </script>

<style>
  /* Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .modal-overlay.show {
    opacity: 1;
    visibility: visible;
  }

  .modal-content {
    background: white;
    border-radius: 1rem;
    padding: 0;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    transform: scale(0.9) translateY(20px);
    transition: all 0.3s ease;
  }

  .modal-overlay.show .modal-content {
    transform: scale(1) translateY(0);
  }

  .modal-header {
    padding: 1.5rem 1.5rem 0;
    border-bottom: 1px solid #e5e7eb;
  }

  .modal-header h3 {
    margin: 0;
    color: #1f2937;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .modal-body p {
    margin: 0;
    color: #6b7280;
    font-size: 1rem;
    line-height: 1.5;
  }

  .modal-footer {
    padding: 1rem 1.5rem 1.5rem;
    display: flex;
    gap: 0.75rem;
    justify-content: flex-end;
  }

  .btn-cancel,
  .btn-confirm {
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
  }

  .btn-cancel {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
  }

  .btn-cancel:hover {
    background: #e5e7eb;
    transform: translateY(-1px);
  }

  .btn-confirm {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    box-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);
  }

  .btn-confirm:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
  }

  .btn-confirm:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }
</style>
  </script>
</Layout>
